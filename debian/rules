#!/usr/bin/make -f

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

# See FEATURE AREAS in dpkg-buildflags(1)
export DEB_BUILD_MAINT_OPTIONS = hardening=+all

%:
	dh $@

override_dh_auto_clean:
	rm -rf node_modules apps/cli/node_modules apps/cli/build apps/cli/dist
	dh_auto_clean

override_dh_auto_build:
	# APPROACH: Build from source
	# The orig.tar.gz should contain the full Bitwarden clients source code
	# This expects the source structure from bitwarden/clients repository

	@echo "Installing dependencies..."
	npm ci

	@echo "Building CLI..."
	cd apps/cli && npm run dist:oss:lin

	@echo "Build completed successfully"

override_dh_auto_install:
	# Install the built binary
	install -D -m 0755 apps/cli/dist/oss/linux/bw debian/bitwarden-cli/usr/bin/bw

override_dh_auto_test:
	# Skip tests for now
	:
